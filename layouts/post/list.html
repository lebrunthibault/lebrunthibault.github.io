{{- define "title" -}}
Blog
{{- end -}}

{{- define "content" -}}
  <section id="posts" class="mt-6 sm:mt-8 md:mt-10">
    {{- $posts := where .Site.RegularPages "Type" "post" }}
    {{- $posts = where $posts ".Params.prod" true }}
    {{- $posts = where $posts ".Params.draft" "!=" true }}
    {{- $posts = where $posts ".Params.hOiddenfromhomepage" "!=" true }}

    {{/* Group posts by category inferred from directory structure */}}
    {{- $.Scratch.Set "categories" slice }}
    {{- range $posts }}
      {{- $path := .File.Dir }}
      {{- $parts := split $path "/" }}
      {{- $cat := "Uncategorized" }}
      {{- if gt (len $parts) 1 }}
        {{- $cat = index $parts 1 }}
      {{- end }}
      {{- if not (in ($.Scratch.Get "categories") $cat) }}
        {{- $.Scratch.Add "categories" $cat }}
      {{- end }}
    {{- end }}

    {{/* Display posts grouped by category */}}
    {{- range $category := $.Scratch.Get "categories" }}
      <div class="mb-8 sm:mb-10 md:mb-12">
        <h1>{{ $category | title }}</h1>
        {{- range $posts }}
          {{- $path := .File.Dir }}
          {{- $parts := split $path "/" }}
          {{- $postCat := "Uncategorized" }}
          {{- if gt (len $parts) 1 }}
            {{- $postCat = index $parts 1 }}
          {{- end }}
          {{- if eq $postCat $category }}
        <a href="{{ .Permalink }}">
          <div class="card px-4 sm:px-6 md:px-8 py-3 sm:py-4 mb-4 sm:mb-6 border-primary shadow-md bg-neutral-primary">
            <h2 class="mt-0">
              {{ .Title }}
            </h2>
            {{- if .Description }}
            <p class="text-[#444] text-sm sm:text-base leading-relaxed mb-3 sm:mb-4">{{ .Description }}</p>
            {{- else if .Summary }}
            <p class="text-[#444] text-sm sm:text-base leading-relaxed mb-3 sm:mb-4">{{ .Summary }}</p>
            {{- end }}
            {{- if .Params.keywords }}
            <div class="flex gap-2 flex-wrap">
              {{- range .Params.keywords }}
              {{ partial "components/tag.html" (dict "text" .) }}
              {{- end }}
            </div>
            {{- end }}
          </div>
        </a>
          {{- end }}
        {{- end }}
      </div>
    {{- end }}
  </section>
{{- end -}}

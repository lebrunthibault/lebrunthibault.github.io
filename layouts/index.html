{{- define "content" -}}
  <section id="posts" class="posts">
    {{- $posts := where (where .Site.RegularPages "Type" "post") ".Params.prod" true }}
    {{- $posts = where $posts ".Params.hOiddenfromhomepage" "!=" true }}

    {{/* Group posts by category using Scratch */}}
    {{- $.Scratch.Set "categories" slice }}
    {{- range $posts }}
      {{- $cat := .Params.category | default "Uncategorized" }}
      {{- if not (in ($.Scratch.Get "categories") $cat) }}
        {{- $.Scratch.Add "categories" $cat }}
      {{- end }}
    {{- end }}

    {{/* Display posts grouped by category */}}
    {{- range $category := $.Scratch.Get "categories" }}
      <div class="category-section">
        <h2 class="category-title">{{ $category }}</h2>
        {{- range $posts }}
          {{- $postCat := .Params.category | default "Uncategorized" }}
          {{- if eq $postCat $category }}
            <h3><a href="{{ .Permalink }}">{{ cond (eq (.Title) "") .File.Path .Title }}</a></h3>
          {{- end }}
        {{- end }}
      </div>
    {{- end }}
  </section>
{{- end -}}

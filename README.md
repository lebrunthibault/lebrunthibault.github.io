# Codebase Organization Documentation

## Overview

This is a personal Hugo-powered blog by Thibault Lebrun, deployed on GitHub Pages. The blog contains markdown articles
organized in a hierarchical category structure. The codebase uses the "Even" Hugo theme with custom layouts, SASS styling, and Algolia search integration.

**Repository:** https://github.com/lebrunthibault/lebrunthibault.github.io  
**Website:** https://lebrunthibault.github.io/  
**Hugo Version:** 0.93.2 (Extended)

---

## 1. Directory Structure Overview

```
blog/
├── config.toml                 # Main Hugo configuration
├── Makefile                    # Build automation commands
├── package.json                # Node.js dependencies (Algolia)
├── package-lock.json
├── .gitmodules                 # Git submodule configuration
├── .gitignore
├── .env                        # Environment variables (empty)
├── README.md                   # Minimal project README
│
├── content/                    # Content source files
│   └── post/                   # Blog posts
│       ├── articles/           # General articles
│       ├── backend development/ # Backend/software topics
│       ├── dev/                # Development utilities
│       ├── ecologie/           # Ecology & sustainability
│       ├── misc/               # Miscellaneous topics
│       └── music/              # Music production
│
├── layouts/                    # Custom Hugo layout templates
│   ├── index.html              # Custom homepage layout
│   ├── partials/               # Reusable template partials
│   │   ├── algolia.html        # Algolia search integration
│   │   ├── scripts.html        # Script includes & Prism.js
│   │   └── footer.html         # Custom footer
│   ├── post/                   # Post-specific templates
│   └── shortcodes/             # Custom shortcodes
│       └── code.html           # Code block shortcode
│
├── themes/                     # Hugo themes
│   └── even/                   # Even theme (git submodule)
│       ├── layouts/            # Theme layouts
│       ├── assets/             # Theme assets
│       ├── i18n/               # i18n translations
│       └── static/             # Theme static files
│
├── assets/                     # Project SASS assets (compiled to CSS)
│   └── sass/
│       └── _custom/            # Custom SASS imports
│           ├── _custom.scss    # Main custom styles
│           ├── _accordion.scss # Dropdown menu styles
│           ├── _code.scss      # Code block styling
│           └── _dev_mode.scss  # Development mode styling
│
├── static/                     # Static files (copied as-is to public/)
│   ├── css/                    # Static CSS files
│   │   └── prism.css          # Syntax highlighting (Prism.js)
│   ├── js/                     # Static JavaScript
│   │   └── prism.js           # Syntax highlighting (Prism.js)
│   ├── img/                    # Images and media
│   │   └── octa.PNG
│   ├── doc/                    # Documentation files
│   └── code/                   # Code examples
│
├── archetypes/                 # Template blueprints for new content
│   └── default.md              # Default post template
│
├── data/                       # Data files (JSON, YAML, TOML)
│   └── (contains octa.PNG image)
│
├── algolia/                    # Algolia search integration
│   ├── index_documents.py      # Python script to index docs
│   └── settings.json           # Algolia index settings
│
├── .github/                    # GitHub configuration
│   └── workflows/
│       └── gh-pages.yml        # GitHub Actions CI/CD pipeline
│
├── resources/                  # Hugo resources cache
│   └── _gen/                   # Generated resources
│
├── public/                     # Build output (generated by Hugo)
│   └── (compiled HTML, CSS, JS)
│
├── docs/                       # Documentation folder (minimal usage)
└── .idea/                      # JetBrains IDE configuration
```

---

## 2. Content Organization

### Content Structure

All blog content resides in `/content/post/` organized by category and subcategory.

Articles are organized in a hierarchical directory structure where each category can contain subcategories and markdown files.

### Frontmatter Structure

Posts use YAML frontmatter (delimited by `---`). Example:

```yaml
---
title: "Article Title"
draft: true
---
```

Supported Frontmatter Fields:
- `title` (string, required) - Post title
- `draft` (boolean, optional) - Hide draft posts in production builds
- `description` (string, optional) - Short description for Algolia search
- `keywords` (array, optional) - Keywords for search tagging
- `prod` (boolean, optional) - Custom flag for production status (used in homepage)

The archetypes/default.md template provides a minimal blueprint for new posts:
```yaml
---
title: "{{ replace .Name "-" " " | title }}"
draft: true
---
```

---

## 3. Theme Configuration

### Theme: Even

The blog uses the **Even** theme, a clean and minimalist Hugo theme.

- **Source:** https://github.com/olOwOlo/hugo-theme-even
- **Installation:** Git submodule at `/themes/even/`
- **Theme Version:** Latest from git submodule

The theme provides:
- Base layouts and styling
- Default post/page templates
- i18n support (10+ languages)
- Archive, tag, and category pages
- RSS feed generation

### Theme Customizations

**Custom Layouts** (`/layouts/`):
- `/layouts/index.html` - Custom homepage with filtered post display
- `/layouts/partials/algolia.html` - Algolia search widget
- `/layouts/partials/scripts.html` - Custom script includes
- `/layouts/partials/footer.html` - Custom footer
- `/layouts/post/` - Post-specific overrides (if any)
- `/layouts/shortcodes/code.html` - Custom code shortcode

**Custom SASS** (`/assets/sass/_custom/`):
- `_custom.scss` - Main custom styles (search widget positioning, post layout)
- `_accordion.scss` - Dropdown menu styles for nested content
- `_code.scss` - Code block styling
- `_dev_mode.scss` - Development mode styling

---

## 4. Configuration Files

### config.toml

Main Hugo configuration with key settings:

**Key Features:**
- Git info enabled for last modification dates
- Chroma-based syntax highlighting with class output
- CDN-hosted jQuery and FancyBox for image galleries
- RSS feed generation enabled
- Safe HTML rendering in markdown allowed

---

## 5. Build & Deployment

### Local Development

**Makefile** (`/Makefile`):

### Continuous Integration/Deployment

**GitHub Actions** (`.github/workflows/gh-pages.yml`):

**Deployment Flow:**
1. Push to `master` branch
2. GitHub Actions triggers build
3. Hugo builds static site to `/public`
4. Artifacts deployed to `build` branch (GitHub Pages source)
5. Site live at https://lebrunthibault.github.io/

**Notes:**
- Algolia indexing is commented out in the workflow (not currently automated)
- Uses `hugo -D` flag to include drafts in build

## 6. Algolia Search Integration

### Purpose

Implements full-text search functionality via Algolia (a hosted search platform).

### Files

**`/algolia/index_documents.py`:**
- Python script to parse markdown files and extract searchable content
- Reads frontmatter metadata (title, description, keywords)
- Extracts markdown headers using the `markdown` library's TOC extension
- Creates searchable documents with structure:
  ```python
  {
    "objectID": title,
    "title": title,
    "description": post.get("description"),
    "keywords": post.get("keywords"),
    "headers": [...],  # List of all headers
    "draft": post.get("draft", False),
    "url": f"/post/{filename}"
  }
  ```
- Pushes documents to Algolia index via API
- Applies Algolia index settings from `settings.json`

**`/algolia/settings.json`:**
Algolia index configuration:

Script: `npm run algolia` - Pushes indexed documents to Algolia

### Frontend Search Widget

**`/layouts/partials/algolia.html`:**
- Loads Algolia libraries via CDN:
  - `algoliasearch-lite@4.5.1`
  - `instantsearch.js@4.8.3`
  - `instantsearch.css@7.4.5`
- Implements custom search box UI with:
  - Query-length validation (minimum 3 characters)
  - Draft filtering in production mode
  - Highlighted results with title, description, keywords, and headers
  - Keyboard navigation (Enter to first result)
  - Click-outside detection to hide results
- Credentials:
  - Algolia App ID: `F3KLJN3L59`
  - Search Key: `85cd499b6fcbe9010c77a66bbee801b3` (public)
  - Admin Key: From environment variable (secrets)

### Automation

Environment variables required:
- `ALGOLIA_APP_ID` - Algolia application ID
- `ALGOLIA_ADMIN_KEY` - Admin key for indexing
- `ALGOLIA_INDEX_NAME` - Index name ("blog")

Currently commented out in CI/CD workflow; would need to be enabled and require secrets setup.

---

## 7. Static Assets Organization

### CSS

**`/static/css/prism.css`**
- Prism.js syntax highlighting theme
- Used for code block styling

**Custom SASS** (compiled to CSS):
- `/assets/sass/_custom/_custom.scss` - Main styles
  - Search widget positioning (absolute, top-right)
  - Post layout and typography
  - Table of contents styling
  - Footer positioning
- `/assets/sass/_custom/_accordion.scss` - Collapsible menus
- `/assets/sass/_custom/_code.scss` - Code block styling
- `/assets/sass/_custom/_dev_mode.scss` - Development mode

### JavaScript

**`/static/js/prism.js`**
- Prism.js syntax highlighting library
- Client-side code highlighting for `<pre><code>` blocks

**Included via CDN** (in `/layouts/partials/scripts.html`):
- jQuery 3.2.1
- Slideout (mobile menu)
- FancyBox 3.1.20 (image lightbox)
- Algolia InstantSearch (search widget)

### Images & Media

**`/static/img/`**
- Contains blog images (e.g., `octa.PNG`)
- Images can be referenced in markdown as `/img/filename`

**`/static/doc/`**
- Documentation files

**`/static/code/`**
- Code examples/samples

---

## 8. Special Features & Customizations

### Dev Mode

**Enabled by URL parameter or localStorage:**
- Query params: `?dev` or `?d`
- localStorage: `dev-mode` key
- When enabled:
  - Draft posts are shown
  - Homepage shows "dev" class on posts container
  - Search includes drafts

**Toggle via JavaScript** (in `algolia.html`):
```javascript
function isDevMode() {
  // Check URL params or localStorage
  return devMode && new URLSearchParams(window.location.search).get("prod") === null
}
```

### Homepage Filtering

**Custom `/layouts/index.html`:**
- Filters posts by `hOiddenfromhomepage` param
- Only shows posts with `prod: true` frontmatter in default view
- Shows hidden posts in dev mode

### Table of Contents

- Auto-generated from headers
- Auto-collapse feature enabled
- Custom styling in SASS

### Code Highlighting

Dual system:
- **Server-side:** Chroma (Hugo) with class output
- **Client-side:** Prism.js as fallback
- FancyBox for image galleries
- Accordion dropdowns for nested code

### Syntax Highlighting Dependencies

- Uses Prism.js for client-side highlighting
- Prism CSS/JS loaded from `/static/`
- Line numbers enabled in Hugo config: `pygmentsOptions = "linenos=table"`

---

## 9. Key Dependencies & Technologies

### Build Tools
- **Hugo** v0.93.2 (Extended) - Static site generator
- **Python 3** - Development scripts and Algolia indexing
  - Dependencies: `frontmatter`, `markdown`, `algoliasearch`, `python-dotenv`
- **Node.js/npm** - Package manager
  - `atomic-algolia` - Algolia indexing wrapper

### Frontend Libraries (CDN)
- **jQuery** 3.2.1 - DOM manipulation
- **Slideout** 1.0.1 - Mobile menu
- **FancyBox** 3.1.20 - Image gallery/lightbox
- **Algolia InstantSearch** 4.8.3 - Search UI
- **Prism.js** - Syntax highlighting

### Themes & Templates
- **Even Theme** (git submodule) - Hugo theme base
- i18n support: English, French, Spanish, German, Russian, Japanese, Turkish, Chinese (CN/TW)

### Hosting & Deployment
- **GitHub Pages** - Static site hosting
- **GitHub Actions** - CI/CD automation
- **Algolia** - Search-as-a-service platform

---

## 10. Recent Development Activity

**Recent Commits:**
- `49fb3fe` - Add session article
- `8326df7` - Merge branch 'master'
- `7257a1a` to `013b67b` - Backup commits

**Git Configuration:**
- Main branch: `master`
- Build output branch: `build` (published to GitHub Pages)
- Submodules: Even theme tracking remote

---

## 11. Common Workflows

### Adding a New Post

1. Create markdown file in appropriate category:
   ```bash
   # Example: new Python article
   touch content/post/backend\ development/python/new-topic.md
   ```

2. Use archetype template with frontmatter:
   ```yaml
   ---
   title: "Article Title"
   draft: true
   description: "Short description for search"
   keywords: ["keyword1", "keyword2"]
   ---
   
   # Article content in markdown
   ```

3. Test with dev mode enabled
4. Remove `draft: true` when ready to publish
5. Commit and push to master branch

### Publishing Changes


### Local Development

```bash
make dev  # Starts dev server with hot reload
```

### Updating Theme

```bash
cd themes/even
git pull origin master
cd ../..
git add themes/even
git commit -m "Update Even theme"
```

### Rebuilding Algolia Index

```bash
npm run algolia
```

Requires environment variables: `ALGOLIA_APP_ID`, `ALGOLIA_ADMIN_KEY`, `ALGOLIA_INDEX_NAME`

---

## 12. Key Customization Points

### To modify appearance:
- `/assets/sass/_custom/*.scss` - Custom styles
- `/layouts/partials/footer.html` - Footer content
- `config.toml` - Site metadata and theme parameters

### To add new functionality:
- `/layouts/shortcodes/` - Add custom shortcodes
- `/layouts/partials/` - Add template partials
- `config.toml` - Configure new parameters

### To change content structure:
- Create new directories in `/content/post/`
- Hugo automatically creates taxonomy pages

### To customize search:
- `/algolia/settings.json` - Index settings
- `/layouts/partials/algolia.html` - Search UI
- `/algolia/index_documents.py` - Index extraction logic

---

## 13. Performance & Optimization

- **Pagination:** 50 posts per page for archives/categories
- **Syntax highlighting:** Server-side Chroma with class output (optimized)
- **CDN-hosted libraries:** jQuery, FancyBox, Algolia for reduced server load
- **Minimification:** Not configured (can add `hugo --minify` to build)
- **Git info tracking:** Enables efficient last-modified tracking

---

## 14. SEO & Accessibility

- **Sitemap:** Auto-generated at `/sitemap.xml` with weekly change frequency
- **Robots.txt:** Auto-generated
- **Git commit history:** Used for accurate last-modified dates
- **Open Graph/Twitter Cards:** Support from Even theme
- **Emoji support:** Enabled in Hugo config
- **RSS feed:** Generated at `/index.xml`

---

## Notes for Future Sessions

1. **Search Implementation:** Algolia is configured but indexing is disabled in CI/CD. Can be enabled by uncommenting workflow steps and adding secrets.

2. **Draft Posts:** Posts with `draft: true` are:
   - Not visible to public
   - Visible in dev mode (?dev query param)
   - Includable in builds with `hugo -D` flag

3. **Custom Post Filtering:** Homepage uses `prod: true` to determine visibility, allowing granular control beyond just draft status.

4. **Theme Customization:** Most visual customization is in SASS files rather than overriding theme templates, keeping it maintainable.

5. **Markdown Processing:** Hugo uses Goldmark with `unsafe = true`, allowing HTML tags in markdown if needed.

6. **Dev Mode Detection:** JavaScript checks URL params and localStorage for dev mode status to control post visibility and search behavior.

